<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bareflank Hypervisor: mk::mk_main_t Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Bareflank Hypervisor
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classmk_1_1mk__main__t.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classmk_1_1mk__main__t-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">mk::mk_main_t Class Reference<span class="mlabels"><span class="mlabel">final</span></span></div></div>
</div><!--header-->
<div class="contents">

<p>Provide the main entry point for the microkernel. The microkernel actually starts in the _start function, and immediately creates this class and calls its <a class="el" href="classmk_1_1mk__main__t.html#af4f1d9ce209ce8a7e82881f80469859e" title="Process the mk_args_t provided by the loader. If the user provided command succeeds,...">process()</a> function to boot the microkernel, start the extensions and eventually demote the CPU. Like the other main classes, this class serves to encapsulate the entry logic into something that can be easily tested with no dependencies on global resources.  
 <a href="classmk_1_1mk__main__t.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="mk__main__t_8hpp_source.html">mk_main_t.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:af4f1d9ce209ce8a7e82881f80469859e"><td class="memItemLeft" align="right" valign="top">constexpr auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmk_1_1mk__main__t.html#af4f1d9ce209ce8a7e82881f80469859e">process</a> (<a class="el" href="structmk_1_1tls__t.html">tls_t</a> &amp;mut_tls, <a class="el" href="namespacemk.html#ac368255bdd961fd8997f08099b0f0947">page_pool_t</a> &amp;mut_page_pool, <a class="el" href="classmk_1_1huge__pool__t.html">huge_pool_t</a> &amp;mut_huge_pool, <a class="el" href="classmk_1_1intrinsic__t.html">intrinsic_t</a> &amp;mut_intrinsic, <a class="el" href="classmk_1_1vm__pool__t.html">vm_pool_t</a> &amp;mut_vm_pool, <a class="el" href="classmk_1_1vp__pool__t.html">vp_pool_t</a> &amp;mut_vp_pool, <a class="el" href="classmk_1_1vs__pool__t.html">vs_pool_t</a> &amp;mut_vs_pool, <a class="el" href="classmk_1_1ext__pool__t.html">ext_pool_t</a> &amp;mut_ext_pool, <a class="el" href="namespacemk.html#a6eb130b521649a4ca56bb0f9902a2ce9">root_page_table_t</a> &amp;mut_system_rpt, <a class="el" href="classmk_1_1vmexit__log__t.html">vmexit_log_t</a> &amp;mut_log, <a class="el" href="structloader_1_1mk__args__t.html">loader::mk_args_t</a> &amp;mut_args) noexcept -&gt; bsl::errc_type</td></tr>
<tr class="memdesc:af4f1d9ce209ce8a7e82881f80469859e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process the <a class="el" href="structmk__args__t.html" title="Defines the arguments sent to the _start function of the microkernel. The microkernel will have it&#39;s ...">mk_args_t</a> provided by the loader. If the user provided command succeeds, this function will return bsl::errc_success, otherwise this function will return bsl::errc_failure.  <a href="classmk_1_1mk__main__t.html#af4f1d9ce209ce8a7e82881f80469859e">More...</a><br /></td></tr>
<tr class="separator:af4f1d9ce209ce8a7e82881f80469859e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Provide the main entry point for the microkernel. The microkernel actually starts in the _start function, and immediately creates this class and calls its <a class="el" href="classmk_1_1mk__main__t.html#af4f1d9ce209ce8a7e82881f80469859e" title="Process the mk_args_t provided by the loader. If the user provided command succeeds,...">process()</a> function to boot the microkernel, start the extensions and eventually demote the CPU. Like the other main classes, this class serves to encapsulate the entry logic into something that can be easily tested with no dependencies on global resources. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="af4f1d9ce209ce8a7e82881f80469859e" name="af4f1d9ce209ce8a7e82881f80469859e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4f1d9ce209ce8a7e82881f80469859e">&#9670;&nbsp;</a></span>process()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr auto mk::mk_main_t::process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structmk_1_1tls__t.html">tls_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_tls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacemk.html#ac368255bdd961fd8997f08099b0f0947">page_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_page_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1huge__pool__t.html">huge_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_huge_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1intrinsic__t.html">intrinsic_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_intrinsic</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1vm__pool__t.html">vm_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_vm_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1vp__pool__t.html">vp_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_vp_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1vs__pool__t.html">vs_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_vs_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1ext__pool__t.html">ext_pool_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_ext_pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacemk.html#a6eb130b521649a4ca56bb0f9902a2ce9">root_page_table_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_system_rpt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classmk_1_1vmexit__log__t.html">vmexit_log_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_log</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structloader_1_1mk__args__t.html">loader::mk_args_t</a> &amp;&#160;</td>
          <td class="paramname"><em>mut_args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> -&gt; bsl::errc_type
        </td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">constexpr</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process the <a class="el" href="structmk__args__t.html" title="Defines the arguments sent to the _start function of the microkernel. The microkernel will have it&#39;s ...">mk_args_t</a> provided by the loader. If the user provided command succeeds, this function will return bsl::errc_success, otherwise this function will return bsl::errc_failure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mut_tls</td><td>the current TLS block </td></tr>
    <tr><td class="paramname">mut_page_pool</td><td>the page_pool_t to use </td></tr>
    <tr><td class="paramname">mut_huge_pool</td><td>the <a class="el" href="classmk_1_1huge__pool__t.html" title="The huge pool provides access to physically contiguous memory. The amount of memory that is available...">huge_pool_t</a> to use </td></tr>
    <tr><td class="paramname">mut_intrinsic</td><td>the <a class="el" href="classmk_1_1intrinsic__t.html" title="Provides raw access to intrinsics. Instead of using global functions, the intrinsics class provides a...">intrinsic_t</a> to use </td></tr>
    <tr><td class="paramname">mut_vm_pool</td><td>the <a class="el" href="classmk_1_1vm__pool__t.html" title="Defines the microkernel&#39;s vm_pool_t.">vm_pool_t</a> to use </td></tr>
    <tr><td class="paramname">mut_vp_pool</td><td>the <a class="el" href="classmk_1_1vp__pool__t.html" title="Defines the microkernel&#39;s vp_pool_t.">vp_pool_t</a> to use </td></tr>
    <tr><td class="paramname">mut_vs_pool</td><td>the <a class="el" href="classmk_1_1vs__pool__t.html" title="Defines the microkernel&#39;s vs_pool_t.">vs_pool_t</a> to use </td></tr>
    <tr><td class="paramname">mut_ext_pool</td><td>the <a class="el" href="classmk_1_1ext__pool__t.html" title="Defines the microkernel&#39;s extension pool.">ext_pool_t</a> to use </td></tr>
    <tr><td class="paramname">mut_system_rpt</td><td>the system RPT provided by the loader </td></tr>
    <tr><td class="paramname">mut_log</td><td>the VMExit log to use </td></tr>
    <tr><td class="paramname">mut_args</td><td>the loader provided arguments to the microkernel. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>If the user provided command succeeds, this function will return bsl::errc_success, otherwise this function will return bsl::errc_failure. </dd></dl>
<p >NOTE:</p><ul>
<li>Make sure that we have not already been loaded on this PP. If we have, we have a problem.</li>
</ul>
<p >NOTE:</p><ul>
<li>Verify that the arguments make sense. This is really there to ensure the loader and the entry logic did their job correctly.</li>
</ul>
<p >NOTE:</p><ul>
<li>Print our logo. We do this after we verify the arguments because if there is an error with the arguments, the logo many not be able to safely print.</li>
</ul>
<p >NOTE:</p><ul>
<li>Set up the stack pointer and TLS pointer for all of the extensions. Remember that each extension has the same address space layout, so their SP and TP is the same for each PP. If we add ALSR, this will have to be modified.</li>
</ul>
<p >NOTE:</p><ul>
<li>Initialize the PP. How this is done depends on whether or not the PP is the BSP.</li>
</ul>
<p >NOTE:</p><ul>
<li>Boostrap all of the PPs for all of the extensions. Once this is done, we should be ready to start the hypervisor.</li>
</ul>
<p >NOTE:</p><ul>
<li>Perform some last minute sanity checks.</li>
</ul>
<p >NOTE:</p><ul>
<li>Start the hypervisor.</li>
</ul>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>kernel/src/<a class="el" href="mk__main__t_8hpp_source.html">mk_main_t.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemk.html">mk</a></li><li class="navelem"><a class="el" href="classmk_1_1mk__main__t.html">mk_main_t</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
